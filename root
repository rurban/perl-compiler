{"version":1,"ops":[{"type":1,"author":{"id":"dc64d6d260e2683565fe6e13d60cfbe9fec0fa09"},"timestamp":1426203061,"metadata":{"github-id":"MDU6SXNzdWU2MDkzNTQyMg==","github-url":"https://github.com/rurban/perl-compiler/issues/79","origin":"github"},"title":"d527ce7c pp_caller UTF8 cleanup broke B::C XSLoader","message":"Original [issue 77](https://code.google.com/p/perl-compiler/issues/detail?id=77) created by rurban on 2011-10-13T23:28:12.000Z:\n\nUpstream change broke XSLoader\nSee https://rt.perl.org:443/rt3/Ticket/Display.html?id=101336 \n\nThis commit d527ce7c3632e2eaebee9f962268da87e0becd51\nAuthor: Brian Fraser \u0026lt;fraserbn@gmail.com\u0026gt;\nDate:   Mon Sep 26 15:32:45 2011 -0700\n\n```\npp_ctl.c: pp_caller UTF8 cleanup.\n```\n\nusing the stash hek instead of the stash name broke the B::C compiler, \nesp. for XSLoader, loading dynamic modules from within C.\nOverwriting the static cop with the new HEK fails with\n# \u0026nbsp;0  0x00007fff812fd0b6 in __kill ()\n# \u0026nbsp;1  0x00007fff8139d9f6 in abort ()\n# \u0026nbsp;2  0x00007fff8138a9bc in __assert_rtn ()\n# \u0026nbsp;3  0x00000001002ae422 in S_unshare_hek_or_pvn (hek=0x10062d1e8, str=0x0, len=0, hash=0) at hv.c:2588\n# \u0026nbsp;4  0x00000001002ae3a6 in Perl_unshare_hek (hek=0x10062d1e8) at hv.c:2561\n# \u0026nbsp;5  0x000000010030da9c in Perl_sv_force_normal_flags (sv=0x1000cf990, flags=4) at sv.c:4829\n# \u0026nbsp;6  0x000000010030c4a8 in Perl_sv_usepvn_flags (sv=0x1000cf990, ptr=0x100608650 \u0026quot;Data::Dumper\u0026quot;, len=12, flags=256) at sv.c:4659\n# \u0026nbsp;7  0x000000010030c08b in Perl_sv_sethek (sv=0x1000cf990, hek=0x100608648) at sv.c:4618\n# \u0026nbsp;8  0x00000001003974ad in Perl_pp_caller () at pp_ctl.c:1911\n# \u0026nbsp;9  0x000000010025d2af in Perl_runops_debug () at dump.c:2201\n# \u0026nbsp;10 0x000000010017ab91 in Perl_call_sv (sv=0x1000c96b0, flags=5) at perl.c:2665\n# \u0026nbsp;11 0x000000010017a56e in Perl_call_pv (sub_name=0x1000a4b8d \u0026quot;XSLoader::load\u0026quot;, flags=5) at perl.c:2568\n# \u0026nbsp;12 0x000000010009fd20 in dl_init () at ccode45.c:28187\n\nThis was not an issue with the stashname.\nRepro: \n$ cpan B::C\n$ t/testc.sh 45\n\nI found no way to workaround this.","files":null}]}