{"version":1,"ops":[{"type":1,"author":{"id":"56586ed5deca9cd92c92f9ff0458b9bd60f911f3"},"timestamp":1443160700,"metadata":{"github-id":"MDU6SXNzdWUxMDgyNjkwMDU=","github-url":"https://github.com/rurban/perl-compiler/issues/214","origin":"github"},"title":"PL_sv_objcount was deprecated in 5.18 and removed in 5.20","message":"we should not use PL_sv_objcount any more after 5.18+\n\nin `B::PVMG::save_magic` for example this is going to be an issue the logic is incorrect\n\n```\n      unless ($fullname eq 'main::STDOUT' and $] \u003e= 5.018) \n=~  if ( $fullname ne 'main::STDOUT' || $] \u003c 5.018 )\n```\n\n```\n      unless ($fullname eq 'main::STDOUT' and $] \u003e= 5.018) {\n        $pkg-\u003esave($fullname);\n\n        no strict 'refs';\n        warn sprintf( \"xmg_stash = \\\"%s\\\" (0x%x)\\n\", $pkg-\u003eNAME, $$pkg )\n          if $debug{mg} or $debug{gv};\n        # Q: Who is initializing our stash from XS? -\u003esave is missing that.\n        # A: We only need to init it when we need a CV\n        # defer for XS loaded stashes with AMT magic\n        $init-\u003eadd( sprintf( \"SvSTASH_set(s\\\\_%x, (HV*)s\\\\_%x);\", $$sv, $$pkg ) );\n        $init-\u003eadd( sprintf( \"SvREFCNT((SV*)s\\\\_%x) += 1;\", $$pkg ) );\n        $init-\u003eadd(\"++PL_sv_objcount;\") unless ref($sv) eq \"B::IO\";\n        # XXX\n        #push_package($pkg-\u003eNAME);  # correct code, but adds lots of new stashes\n      }\n```","files":null}]}