{"version":1,"ops":[{"type":1,"author":{"id":"dc64d6d260e2683565fe6e13d60cfbe9fec0fa09"},"timestamp":1426241796,"metadata":{"github-id":"MDU6SXNzdWU2MTAyOTU3Ng==","github-url":"https://github.com/rurban/perl-compiler/issues/120","origin":"github"},"title":"-O3 PerlIO_flush problem (testc.sh 91)","message":"Original [issue 118](https://code.google.com/p/perl-compiler/issues/detail?id=118) created by rurban on 2013-02-05T17:50:30.000Z:\n\n\u003cb\u003eWhat steps will reproduce the problem?\u003c/b\u003e\nt/testc.sh -O3 91\nvs.\nt/testc.sh -O0 91\n\nprint \u0026quot;ok\u0026quot; is executed in both cases, just with -O3 the final my_fflush_all() at perl_destruct() doesn't flush STDOUT.\n\nObservation:\nWith -O3 there are multiple calls to PerlIO_close() and PerlIO_flush() during parse and run-time, which does not happen with -O0.\n\n2x:\n# \u0026nbsp;0  Perl_PerlIO_flush (f=0x823b50) at perlio.c:1750\n# \u0026nbsp;1  0x00007ffff7cbfa62 in PerlIOBase_close (f=0x823b50) at perlio.c:2238\n# \u0026nbsp;2  0x00007ffff7cc30cd in PerlIOBuf_close (f=0x823b50) at perlio.c:4262\n# \u0026nbsp;3  0x00007ffff7cbe022 in PerlIO__close (f=0x823b50) at perlio.c:1503\n# \u0026nbsp;4  0x00007ffff7cbe05c in Perl_PerlIO_close (f=0x823b50) at perlio.c:1516\n# \u0026nbsp;5  0x00007ffff79fd9cc in Perl_lex_next_chunk (flags=0) at toke.c:1277\n# \u0026nbsp;6  0x00007ffff7a0e858 in Perl_yylex () at toke.c:4777\n# \u0026nbsp;7  0x00007ffff7a3ce84 in Perl_yyparse (gramtype=258) at perly.c:434\n# \u0026nbsp;8  0x00007ffff79c57b2 in S_parse_body (env=0x7fffffffe718, xsinit=0x62862c \u0026lt;xs_init\u0026gt;) at perl.c:2194\n# \u0026nbsp;9  0x00007ffff79c39b8 in perl_parse (my_perl=0x814010, xsinit=0x62862c \u0026lt;xs_init\u0026gt;, argc=4, argv=0x81eb60, env=0x7fffffffe718)\n\n```\nat perl.c:1613\n```\n\n(gdb) bt\n# \u0026nbsp;0  Perl_PerlIO_flush (f=0x823b70) at perlio.c:1750\n# \u0026nbsp;1  0x00007ffff7afca55 in Perl_pp_print () at pp_hot.c:790\n# \u0026nbsp;2  0x00007ffff7a9d5c3 in Perl_runops_debug () at dump.c:2266\n# \u0026nbsp;3  0x00007ffff79c6898 in S_run_body (oldscope=1) at perl.c:2350\n# \u0026nbsp;4  0x00007ffff79c5b55 in perl_run (my_perl=0x814010) at perl.c:2268\n# \u0026nbsp;5  0x00000000006293f0 in main (argc=1, argv=0x7fffffffe708, env=0x7fffffffe718) at ccode91_o3.c:54882\n\n(gdb) bt\n# \u0026nbsp;0  Perl_PerlIO_flush (f=0x981d50) at perlio.c:1750\n# \u0026nbsp;1  0x00007ffff7cc2795 in PerlIOBuf_flush (f=0x823b70) at perlio.c:4006\n# \u0026nbsp;2  0x00007ffff7cbecb0 in Perl_PerlIO_flush (f=0x823b70) at perlio.c:1755\n# \u0026nbsp;3  0x00007ffff7afca55 in Perl_pp_print () at pp_hot.c:790\n# \u0026nbsp;4  0x00007ffff7a9d5c3 in Perl_runops_debug () at dump.c:2266\n# \u0026nbsp;5  0x00007ffff79c6898 in S_run_body (oldscope=1) at perl.c:2350\n# \u0026nbsp;6  0x00007ffff79c5b55 in perl_run (my_perl=0x814010) at perl.c:2268\n# \u0026nbsp;7  0x00000000006293f0 in main (argc=1, argv=0x7fffffffe708, env=0x7fffffffe718) at ccode91_o3.c:54882\n\nvs \n(gdb) bt\n# \u0026nbsp;0  Perl_PerlIO_flush (f=0x0) at perlio.c:1750\n# \u0026nbsp;1  0x00007ffff7aa7edc in Perl_my_fflush_all () at util.c:3817\n# \u0026nbsp;2  0x00000000006285fc in fast_perl_destruct (my_perl=0x814010) at ccode91_o3.c:54706\n# \u0026nbsp;3  0x0000000000629405 in main (argc=1, argv=0x7fffffffe708, env=0x7fffffffe718) at ccode91_o3.c:54883","files":null}]}