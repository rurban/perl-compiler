{"version":1,"ops":[{"type":3,"author":{"id":"dc64d6d260e2683565fe6e13d60cfbe9fec0fa09"},"timestamp":1443786516,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE0NDk5NzEzNQ==","github-url":"https://github.com/rurban/perl-compiler/issues/219#issuecomment-144997135"},"message":"This started failing with 5.18.\ntestcase: `t/issue172.t` also with `t/testc.sh 172` and now `t/testc.sh 219`\nSee old ticket GH #174 \n\nMaybe the root-cause is my workaround for the broken %version:: SvSTASH. See https://rt.cpan.org/Ticket/Display.html?id=81635\n\nUpdate: It is not. Work in the branch `overload-219`","files":null},{"type":5,"author":{"id":"dc64d6d260e2683565fe6e13d60cfbe9fec0fa09"},"timestamp":1444343081,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQzMDg2NTk2NQ=="},"added":["Priority-High"],"removed":[]},{"type":5,"author":{"id":"dc64d6d260e2683565fe6e13d60cfbe9fec0fa09"},"timestamp":1444343081,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQzMDg2NTk2Ng=="},"added":["Type-Regression"],"removed":[]},{"type":2,"author":{"id":"dc64d6d260e2683565fe6e13d60cfbe9fec0fa09"},"timestamp":1444343141,"metadata":{"github-id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50NDMwODY2NzE5"},"title":"overload \"\" 5.18-5.22","was":"overload stringify 5.18-5.22"},{"type":2,"author":{"id":"dc64d6d260e2683565fe6e13d60cfbe9fec0fa09"},"timestamp":1444343236,"metadata":{"github-id":"MDE3OlJlbmFtZWRUaXRsZUV2ZW50NDMwODY3ODU2"},"title":"overload stringify 5.18-5.22","was":"overload \"\" 5.18-5.22"},{"type":3,"author":{"id":"10c623ced12a685284188dc5ea89cffce509dd3d"},"timestamp":1445298969,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE0OTM3OTc0NQ==","github-url":"https://github.com/rurban/perl-compiler/issues/219#issuecomment-149379745"},"message":"Right. You reported the bug against version except Devel::Peek and version are both perl as upstream. https://rt.cpan.org/Public/Bug/Display.html?id=107459","files":null},{"type":3,"author":{"id":"10c623ced12a685284188dc5ea89cffce509dd3d"},"timestamp":1445300022,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE0OTM4MjQyNw==","github-url":"https://github.com/rurban/perl-compiler/issues/219#issuecomment-149382427"},"message":"Bisected in blead.\n\nc07f9fb2c73bebcf70fabbf464c0c3452af4fcbf is the first bad commit\ncommit c07f9fb2c73bebcf70fabbf464c0c3452af4fcbf\nAuthor: Father Chrysostomos sprout@cpan.org\nDate:   Tue Nov 20 13:47:27 2012 -0800\n\n```\nRevert \"Revert \"8c34e50dc slowed down detruction with no DESTROY\"\"\n\nThis reverts commit 95f9781bc2fad025553db0160ef9c2c5363312a1.\n\nNow that the crash has been fixed by the preceding commit, we can\nreinstate 7cc6787e9db.\n```\n\n:100644 100644 2d1d887fe8b4256b2b5682dc6d26065f12ab5a6d be2038f4e7cdaf2d918c5df419348fca09290ab0 M  mro.c\n:100644 100644 9f5c157a87b3f41f96566337e612a3674c129bbd a7914988e7861ead362d718960a408fd5bd0a5e3 M  sv.c\nbisect run success","files":null},{"type":3,"author":{"id":"10c623ced12a685284188dc5ea89cffce509dd3d"},"timestamp":1445300031,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE0OTM4MjQ0Mw==","github-url":"https://github.com/rurban/perl-compiler/issues/219#issuecomment-149382443"},"message":"Output at offending commit:\n\ncd t \u0026\u0026 (rm -f perl; /bin/ln -s ../perl perl)\nSV = IV(0x8c1e234) at 0x8c1e238\n  REFCNT = 1\n  FLAGS = (TEMP,ROK)\n  RV = 0x8c1e418\n  SV = PVHV(0x8c24010) at 0x8c1e418\n    REFCNT = 4\n    FLAGS = (OOK,OVERLOAD,SHAREKEYS)\n    STASH = 0x10/root/bisect.sh: line 10: 26914 Segmentation fault      ./perl -Ilib -MDevel::Peek=Dump -E'version-\u003enew(\"v5.22.0\");Dump(\\%version::)'","files":null},{"type":3,"author":{"id":"10c623ced12a685284188dc5ea89cffce509dd3d"},"timestamp":1445359061,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE0OTYyNTcxMw==","github-url":"https://github.com/rurban/perl-compiler/issues/219#issuecomment-149625713"},"message":"Reported to upstream. https://rt.perl.org/Public/Bug/Display.html?id=126410","files":null},{"type":5,"author":{"id":"10c623ced12a685284188dc5ea89cffce509dd3d"},"timestamp":1445362110,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQ0MDYwNjY0OQ=="},"added":["Priority-Critical"],"removed":[]},{"type":5,"author":{"id":"10c623ced12a685284188dc5ea89cffce509dd3d"},"timestamp":1445362110,"metadata":{"github-id":"MDE0OlVubGFiZWxlZEV2ZW50NDQwNjA2NjUx"},"added":[],"removed":["Priority-High"]},{"type":3,"author":{"id":"10c623ced12a685284188dc5ea89cffce509dd3d"},"timestamp":1445373762,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE0OTY5NTkzNg==","github-url":"https://github.com/rurban/perl-compiler/issues/219#issuecomment-149695936"},"message":"Even with the patch applied to upstream, the original problem continues to be an issue so I think the upstream Devel::Peek regression is probably a distraction from the primary issue.","files":null},{"type":3,"author":{"id":"10c623ced12a685284188dc5ea89cffce509dd3d"},"timestamp":1445373896,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE0OTY5NjU0Mg==","github-url":"https://github.com/rurban/perl-compiler/issues/219#issuecomment-149696542"},"message":"Test results with fix sent to upstream compiled in to perl 5.22.0\n\n``` sh\n$\u003eperlcc -e'package OverloadTest; use overload q{\"\"} =\u003e sub { ${$_[0]} }; package main; my $foo = bless \\(my $bar = \"ok\"), \"OverloadTest\"; print $foo.\"\\n\";' ; ./a.out\n./a.out\n/usr/local/cpanel/3rdparty/perl/522-debug/bin/perlcc: Unexpected compiler output\n[WARNING] skip SvSTASH for overloaded HV %Errno:: flags=0x3280000c\n [WARNING] unknown (HV*)\u0026sv_list[455] found in @static_free\nOverloadTest=SCALAR(0x8112fb0)\n```","files":null},{"type":3,"author":{"id":"10c623ced12a685284188dc5ea89cffce509dd3d"},"timestamp":1445444992,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE0OTk1Mjc0OQ==","github-url":"https://github.com/rurban/perl-compiler/issues/219#issuecomment-149952749"},"message":"Todd to bisect this today.","files":null},{"type":3,"author":{"id":"dc64d6d260e2683565fe6e13d60cfbe9fec0fa09"},"timestamp":1445453562,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE0OTk5MjQ3NQ==","github-url":"https://github.com/rurban/perl-compiler/issues/219#issuecomment-149992475"},"message":"Patched my_curse for -fno-destruct (-O3) so we don't even need the core patch on older perls.\nSee bd78fe8","files":null},{"type":3,"author":{"id":"10c623ced12a685284188dc5ea89cffce509dd3d"},"timestamp":1445454758,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE0OTk5NzM3Mg==","github-url":"https://github.com/rurban/perl-compiler/issues/219#issuecomment-149997372"},"message":"``` git\n$\u003egit bisect bad\nbee7c5743fabd49c584c5edbb637c66c5c25ca9a is the first bad commit\ncommit bee7c5743fabd49c584c5edbb637c66c5c25ca9a\nAuthor: Father Chrysostomos \u003csprout@cpan.org\u003e\nDate:   Fri May 18 17:02:39 2012 -0700\n\n    sv.c: Donâ€™t fiddle with AMAGIC in sv_bless\n\n    Since overloading itself now checks whether caches are up to date, and\n    since changes to the stash (@ISA, methods) turn the flag on and over-\n    loading itself turns the flag off when it can, sv_bless no longer\n    needs to deal with it at all.\n\n:040000 040000 4a9679f7a036de75ae61b9dda7ebecc3bf5335ba 634b1a9b9c56600fac5f9d9e4335474d106cd95e M  lib\n:100644 100644 0c940cb434f461f262ab8263d2f9f1552a04bcf2 1e7f4d2e341d79f5306194808fd65530a1f628f6 M  sv.c\n```\n\n``` diff\ndiff --git a/sv.c b/sv.c\nindex 0c940cb..1e7f4d2 100644\n--- a/sv.c\n+++ b/sv.c\n@@ -9518,11 +9518,6 @@ Perl_sv_bless(pTHX_ SV *const sv, HV *const stash)\n     SvUPGRADE(tmpRef, SVt_PVMG);\n     SvSTASH_set(tmpRef, MUTABLE_HV(SvREFCNT_inc_simple(stash)));\n\n-    if (Gv_AMG(stash))\n-       SvAMAGIC_on(sv);\n-    else\n-       (void)SvAMAGIC_off(sv);\n-\n     if(SvSMAGICAL(tmpRef))\n         if(mg_find(tmpRef, PERL_MAGIC_ext) || mg_find(tmpRef, PERL_MAGIC_uvar))\n             mg_set(tmpRef);\n```","files":null},{"type":3,"author":{"id":"dc64d6d260e2683565fe6e13d60cfbe9fec0fa09"},"timestamp":1445455370,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1MDAwMDA3OQ==","github-url":"https://github.com/rurban/perl-compiler/issues/219#issuecomment-150000079"},"message":"Uh, now that's interesting and should be pretty simple to fix, thanks!\nIt says that we have to trigger `Gv_AMG`, which initializes and updated the overload cache by ourselves now.","files":null},{"type":5,"author":{"id":"10c623ced12a685284188dc5ea89cffce509dd3d"},"timestamp":1446148506,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQ0OTY3MTg0Mg=="},"added":["CoreTests.522"],"removed":[]},{"type":5,"author":{"id":"10c623ced12a685284188dc5ea89cffce509dd3d"},"timestamp":1446148566,"metadata":{"github-id":"MDE0OlVubGFiZWxlZEV2ZW50NDQ5NjcyODAw"},"added":[],"removed":["CoreTests.522"]},{"type":5,"author":{"id":"10c623ced12a685284188dc5ea89cffce509dd3d"},"timestamp":1446148602,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDQ0OTY3MzM1NA=="},"added":["CoreTests.522"],"removed":[]},{"type":3,"author":{"id":"10c623ced12a685284188dc5ea89cffce509dd3d"},"timestamp":1446150619,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1MjMwOTM0Nw==","github-url":"https://github.com/rurban/perl-compiler/issues/219#issuecomment-152309347"},"message":"./t/testc.sh 219","files":null},{"type":3,"author":{"id":"10c623ced12a685284188dc5ea89cffce509dd3d"},"timestamp":1446663547,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1MzgzMDc0Mg==","github-url":"https://github.com/rurban/perl-compiler/issues/219#issuecomment-153830742"},"message":"https://github.com/CpanelInc/perl-compiler/issues/27 needed a fix because overload cache initialiazation was needed for IO::File. This broke because $pkg was a B::CV and didn't implement NAME. \n\nIt's possible that our %Exporter:: patch triggered the error and may be part of the solution?","files":null},{"type":3,"author":{"id":"56586ed5deca9cd92c92f9ff0458b9bd60f911f3"},"timestamp":1447192130,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NTU3NzM1MA==","github-url":"https://github.com/rurban/perl-compiler/issues/219#issuecomment-155577350"},"message":"a workaround for it is to adjust ISA at run time (using  the overload branch)\n\n``` perl\n#!perl \n\npackage OverloadTest;\nuse overload '\"\"' =\u003e sub { ${$_[0]} };\n\npackage main;\nmy $foo = bless \\(my $bar = \"ok\" ), \"OverloadTest\";\n\nINIT {\n    push @OverloadTest::ISA, 'overload';\n}\nprint \"$foo\\n\";\n```\n\n```\n\u003e perlcc -S -r test.pl\nok\n```","files":null},{"type":3,"author":{"id":"10c623ced12a685284188dc5ea89cffce509dd3d"},"timestamp":1447192263,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NTU3Nzg4OQ==","github-url":"https://github.com/rurban/perl-compiler/issues/219#issuecomment-155577889"},"message":"This is because the HvMROMETA (xpvhv_aux) is updated for the stash when @ISA is changed. We need to start capturing and saving xpvhv_aux for all stashes for now on. This also would probably take away the need to set 'c3' on classes during XS init since this is simply populating that data.","files":null},{"type":3,"author":{"id":"56586ed5deca9cd92c92f9ff0458b9bd60f911f3"},"timestamp":1447194196,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NTU4Njk0Ng==","github-url":"https://github.com/rurban/perl-compiler/issues/219#issuecomment-155586946"},"message":"this dirty commit fixes the overload\nhttps://github.com/CpanelInc/perl-compiler/commit/356e9e152e0b12cea2ee3fdd5baa56024844fc9f","files":null},{"type":3,"author":{"id":"10c623ced12a685284188dc5ea89cffce509dd3d"},"timestamp":1447194555,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NTU4ODI4OQ==","github-url":"https://github.com/rurban/perl-compiler/issues/219#issuecomment-155588289"},"message":"@rurban While that does fix things, the correct solution is to save and properly attach xpvhv_aux where necessary. From the looks of it, the data is static?","files":null},{"type":3,"author":{"id":"dc64d6d260e2683565fe6e13d60cfbe9fec0fa09"},"timestamp":1447194608,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NTU4ODQ5NQ==","github-url":"https://github.com/rurban/perl-compiler/issues/219#issuecomment-155588495"},"message":"No, it's dynamic. I only save it for RITER/EITER, see there. However the code in `mro_isa_changed_in` or `gv_stashpvn`already calls `HvMROMETA()` which initializes the `xpvhv_aux` struct.\nTesting in branch `debug-stashcv-gh219` dbfa262840c2f60c084bc5cb887575258c67d7b0\n\nI tested a static `xpvhv_aux` and it was not possible.","files":null},{"type":3,"author":{"id":"dc64d6d260e2683565fe6e13d60cfbe9fec0fa09"},"timestamp":1447199217,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NTYwNDc0NA==","github-url":"https://github.com/rurban/perl-compiler/issues/219#issuecomment-155604744"},"message":"Fixed with 1.52_18, thanks @atoomic","files":null},{"type":4,"author":{"id":"dc64d6d260e2683565fe6e13d60cfbe9fec0fa09"},"timestamp":1447199218,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50NDYwNzUwODU0"},"status":2}]}